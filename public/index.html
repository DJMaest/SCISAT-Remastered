<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>  
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script> 
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title></title>
    <style>
      .bg-space{
        background-image: url('simple.jpg');
      }
    </style>
  </head>
  <body class="bg-space text-light">
    <header>
      <h1>Trials</h1>
    </header>
    <nav class="navbar navbar-expand-lg navbar-light text-light">
      <a class="navbar-brand text-light mx-5" href="#">Home</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li id="idabout" class="nav-item active mx-5">
            <a class="nav-link text-light" href="about.html">About </a>
          </li>
          <li id="iddocs" class="nav-item active mx-5">
            <a class="nav-link text-light" href="docs.html">API docs </a>
          </li>
        </ul>
      </div>
    </nav>

    <main id='themain' role="main" class="ml-sm-auto px-4">
      <div class="container-fluid" style="display: inline-block;">
        <div id="chartContainer" style="display: inline-block;height: 430px;margin-right: 20px;" class="col-7"></div>
        <div class="col-4" style="display: inline-block;margin-left: 20px;">
          <h4>the heading</h4>
          <p>
            The Wind Imaging Interferometer (WINDII) was launched on NASA's Upper Atmosphere Research Satellite on 12 September 1991 and operated until 2003. Its role in the mission 
            was to measure vector winds in the Earth's atmosphere from 80 to 110 km, but its measurements extended to nearly 300 km. The approach employed was to measure Doppler 
            shifts from a suite of visible region airglow lines emitted over this altitude range. These included atomic oxygen O (1S) and O (1D) lines, as well as lines in the OH Meinel 
            (8,3) and O2 atmospheric (0,0) bands. The instrument used was a Doppler Michelson Interferometer that measured the Doppler shift as a phase shift of the cosinusoidal 
            interferogram generated by single airglow lines. An extensive validation program was conducted after launch to confirm the accuracy of the measurements.
          </p>
          <form class="form-inline">
            <div style="padding-right:0px;padding-left:0px">
              <div class='input-group' style="display: inline;" id='date1'>
                <label for="startd" style="padding-right:4px;margin-bottom:0px;">Start Date: </label>
                <input type="month" id="startd" name="start date" onchange="queryConc(0, this.value)">
              </div>
            </div>
            <div style="padding-right:0px;padding-left:0px">
              <div class='input-group' id='date1' style="display: inline;">
                <label for="endd" style="padding-right:4px;margin-bottom:0px;">End Date: </label>
                <input type="date" id="endd" name="end date" onchange="queryConc(1, this.value)">
              </div>
            </div>
            
          </form>
        </div>
      </div>
    </main>
    
    <script type="text/javascript">

    $(function () {

      $("#chartContainer").CanvasJSChart({
        backgroundColor: "transparent",
        animationEnabled: true,
        title: {
          text: "Ozone plot"
        },
        data: []
      });
      var Pchart = $("#chartContainer").CanvasJSChart();
      //console.log(Pchart);

      document.getElementById("year").innerHTML = new Date().getFullYear();

      $.ajax({
        type: "GET",
        url:"/api/Data?q=2004-03",
        TheChart: Pchart,
        success: function (response) {
          console.log(response, this.TheChart);
          //var thedata = [];
          AddToCanv(response, this.TheChart);
        }
      });

      $.ajax({
        type: "GET",
        url:"/api/Data?q=2004-12",
        TheChart: Pchart,
        success: function (response) {
          console.log(response, this.TheChart);
          //var thedata = [];
          AddToCanv(response, this.TheChart);
        }
      });

    });

    $('#idabout').on('click', 'a', function(e){
      e.preventDefault();
      var url_using = $(this).attr('href');

      $.ajax({
        type: "GET",
        url: "about.html",
        success: function(response){
          $('#themain').html(response);
        }
      });
    });    

    $('#iddocs').on('click', 'a', function(e){
      e.preventDefault();
      var url_using = $(this).attr('href');

      $.ajax({
        type: "GET",
        url: "docs.html",
        success: function(response){
          $('#themain').html(response);
        }
      });
    });

    function AddToCanv(jsonQsec, thechart) {
      console.log(jsonQsec);
      var dataP2 = [];
      //jsonq.Data.forEach((element, index) => {
      for (var j = 0; j < jsonQsec.Data.length; j++) {
        var element = jsonQsec.Data[j];
        var trnsfrm = element.alt_conc[0];
        for (var i = 0; i < trnsfrm.length; i++) {
            if (trnsfrm[i][0] != -999) {
              dataP2.push({x: trnsfrm[i][0], y: trnsfrm[i][1], label: 'Latitude: ' + element.latitude 
              + ', Longitude: ' + element.longitude + ', Time: ' + element.date.slice(0,16) 
              + ', Concentration: ' + trnsfrm[i][0]
              });
            }
        }
      };
      var dataS2 = {type:"scatter", markerSize: 3, name: jsonQsec.Data[1].date.slice(0,7)}; 
      dataS2.dataPoints = dataP2;

      thechart.options.data.push(dataS2);
      thechart.render();
    }

    function queryConc(deterr, MonthD) {
      console.log(deterr, MonthD);
      $.ajax({
        type: "GET",
        url:"/api/Data?q=" + MonthD,
        IndexOfSer: deterr,
        success: function (response) {
          console.log(response);
          var dataPNew = [];
          
          for (var j = 0; j < response.Data.length; j++) {
            var element = response.Data[j];
            var trnsfrm = element.alt_conc[0];
            for (var i = 0; i < trnsfrm.length; i++) {
                if (trnsfrm[i][0] != -999) {
                  dataPNew.push({x: trnsfrm[i][0], y: trnsfrm[i][1], label: 'Latitude: ' + element.latitude
                   + ', Longitude: ' + element.longitude + ', Time: ' + element.date.slice(0,16) 
                   + ', Concentration: ' + trnsfrm[i][0]
                  });
                }
            }
          };
          var dataSNew = {type:"scatter", markerSize: 3, name: element.date.slice(0,7)}; 
          dataSNew.dataPoints = dataPNew;

          var chart = $("#chartContainer").CanvasJSChart();
          console.log(chart);
          chart.data[this.IndexOfSer].remove();
          chart.data.push(dataSNew);
          chart.render();
          console.log(chart);
        }
      });
    }

    </script>
  </body>
  <footer>
    <p>&copy;<span id="year"></span></p>
  </footer>

<!--
  footer: function (tooltipItems, data) {
                        
                        var theone = tooltipItems[3].datasetIndex + 1
                        var interesting = [];
                        interesting = data.datasets[theone].data[tooltipItems[3].index];

                        return 'Ship ID: ' + interesting[0]["Ship ID"] + '\n' +
                            'Product: ' + interesting[0]["Product"] + '\n' +
                            'Car count by Product: ' + interesting[0]["Car count by product"] + '\n' +
                            'Min Weight: ' + interesting[0]["Min weight"] + '\n' +
                            'Max Weight: ' + interesting[0]["Max weight"] + '\n' +
                            'Standard dev: ' + interesting[0]["Standard dev"] + '\n' +
                            'Loss: ' + interesting[0]["Loss"].substr(0,6);



-->

</html>
